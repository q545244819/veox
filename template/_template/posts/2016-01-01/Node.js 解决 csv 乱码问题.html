<div id="wmd-preview" class="wmd-preview"><div class="md-section-divider"></div><div class="md-section-divider"></div><h2 data-anchor-id="s564" id="前言">前言</h2><p data-anchor-id="nhs9">之前有个项目中使用到了一个前端的<a href="http://danml.com/download.html" target="_blank"><code>download.js</code></a>库，主要是用来拼接内容然后生成一个<code>.txt</code>或者<code>.csv</code>等文件让用户下载，不过目前这个库不支持了<code>chrome</code>和<code>safari</code>等<code>webkit</code>内核的浏览器了。而且下载的内容如果有中文字符的话还有乱码的现象。</p><div class="md-section-divider"></div><h2 data-anchor-id="0rjv" id="用-nodejs-生成-csv-文件">用 Node.js 生成 csv 文件</h2><p data-anchor-id="9j4k">想使用<code>Node.js</code>来生成 csv 文件的话，可以自己拼接好内容后通过<code>fs.writeFile</code>来写入一个文件。不过还是有个问题，如果有中文字符的还是会出现乱码的情况。</p><p data-anchor-id="9sey">接下来就是介绍一下两个库可以解决我们的问题，一个是<code>json2csv</code>可以通过<code>json</code>的数据去生成<code>csv</code>文件的内容，然后在<code>fs.writeFile</code>，另外一个库则是<code>iconv-lite</code>用来把内容的编码转换为<code>GBK</code>格式，这样一来就能够解决中文乱码的问题。</p><p data-anchor-id="46xk">还有一个值得一提的，就是有其他的小伙伴会用<code>iconv</code>这个库，不过我发现我使用<code>npm</code>还是<code>cnpm</code>都安装不上，所以就使用了<code>iconv-lite</code>这个库。可以注意一下这个问题。</p><p data-anchor-id="415s">贴一个实例：</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="8z57"><ol class="linenums"><li class="L0"><code><span class="kwd">var</span><span class="pln"> json2csv </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'json2csv'</span><span class="pun">);</span></code></li><li class="L1"><code><span class="kwd">var</span><span class="pln"> iconv </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'iconv-lite'</span><span class="pun">);</span></code></li><li class="L2"><code><span class="kwd">var</span><span class="pln"> fs </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">require</span><span class="pun">(</span><span class="str">'fs'</span><span class="pun">);</span></code></li><li class="L3"><code><span class="kwd">var</span><span class="pln"> fields </span><span class="pun">=</span><span class="pln"> </span><span class="pun">[</span><span class="str">'field1'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'field2'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'field3'</span><span class="pun">];</span><span class="pln"> </span><span class="com">// 这里的内容是不支持中文的。</span></code></li><li class="L4"><code><span class="kwd">var</span><span class="pln"> myData </span><span class="pun">=</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L5"><code><span class="pln">    </span><span class="str">'field1'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'field1'</span><span class="pun">,</span></code></li><li class="L6"><code><span class="pln">    </span><span class="str">'field2'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'field2'</span><span class="pun">,</span></code></li><li class="L7"><code><span class="pln">    </span><span class="str">'field3'</span><span class="pun">:</span><span class="pln"> </span><span class="str">'field3'</span><span class="pun">,</span></code></li><li class="L8"><code><span class="pun">};</span></code></li><li class="L9"><code></code></li><li class="L0"><code><span class="pln">json2csv</span><span class="pun">({</span><span class="pln"> data</span><span class="pun">:</span><span class="pln"> myData</span><span class="pun">,</span><span class="pln"> fields</span><span class="pun">:</span><span class="pln"> fields </span><span class="pun">},</span><span class="pln"> </span><span class="kwd">function</span><span class="pun">(</span><span class="pln">err</span><span class="pun">,</span><span class="pln"> csv</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code><span class="pln">  </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);</span></code></li><li class="L2"><code><span class="pln">  </span><span class="kwd">var</span><span class="pln"> newCsv </span><span class="pun">=</span><span class="pln"> iconv</span><span class="pun">.</span><span class="pln">encode</span><span class="pun">(</span><span class="pln">csv</span><span class="pun">,</span><span class="pln"> </span><span class="str">'GBK'</span><span class="pun">);</span><span class="pln"> </span><span class="com">// 转编码</span></code></li><li class="L3"><code><span class="pln">  fs</span><span class="pun">.</span><span class="pln">writeFile</span><span class="pun">(</span><span class="str">'demo.csv'</span><span class="pun">,</span><span class="pln"> newCsv</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">function</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code><span class="pln">    </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">err</span><span class="pun">)</span><span class="pln"> console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="pln">err</span><span class="pun">);</span></code></li><li class="L5"><code><span class="pln">    console</span><span class="pun">.</span><span class="pln">log</span><span class="pun">(</span><span class="str">'Saved done!'</span><span class="pun">);</span></code></li><li class="L6"><code><span class="pln">  </span><span class="pun">});</span></code></li><li class="L7"><code><span class="pun">});</span></code></li></ol></pre><div class="md-section-divider"></div><h2 data-anchor-id="s0z8" id="相关连接">相关连接</h2><ul data-anchor-id="a50k">
<li><a href="https://cnodejs.org/topic/516e0ab46d382773067a5473" target="_blank">怎么解决数据保存到csv文件乱码问题</a></li>
</ul></div>